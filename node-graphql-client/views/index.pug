doctype html
html(lang='en', data-framework='javascript')
  head
    meta(charset='utf-8')
    title NodeGraphqlClient
    link(rel='stylesheet', href='app.css')
  body
    .container
      section.products
        header.header
          h1=`${shopName}: Node Example`
        ul.product-list
          each product in products
            div
              li.product
                img(src=product.images[0].src)
                .product-info
                  h2=product.title
                  form(method='post' action='/add_line_item' + product.id.substring(product.id.lastIndexOf('/')))
                    each option in product.options
                      label=option.name
                      select(name=option.name)
                        each value in option.values
                          option(value=value.valueOf())
                            =value
                    label Quantity
                    input(min='1', type='number', name='quantity', value='1')
                    input(type="hidden" name="checkoutId" value=cart.id)
                    .buy-button-wrapper
                      button.buy-button.button#add-to-cart-button(type='submit')
                        | Add to cart
                    .product-pricing
      section.view-cart-wrapper
        button.view-cart#view-cart-button Cart
      section.cart#cart(class={'cart--open': isCartOpen})
        section.main
          button.cart-close#close-cart-button Ã—
          h2 Cart
          ul.cart-list
            each item in cart.lineItems
              li
                .view
                  form(method='post' action='/update_line_item' + item.id.substring(item.id.lastIndexOf('/')))
                    input(type='hidden' name='checkoutId' value=cart.id)
                    input.quantity#quantity(min='1' type='number' name='quantity' value=item.quantity)
                  label=`${item.title}: ${item.variant.title}`
                  form(method='post' action='/remove_line_item' + item.id.substring(item.id.lastIndexOf('/')))
                    input(type="hidden" name="checkoutId" value=cart.id)
                    button.destroy(type='submit')
            li
              .view
                label
                  strong Subtotal:
                  =` $${cart.subtotalPrice}`
            li
              .view
                label
                  strong Taxes:
                  =` $${cart.totalTax}`
            li
              .view
                label
                  strong Total:
                  =` $${cart.totalPrice}`
        footer.cart-footer
            button.button#checkout-button(type='submit', disabled=!cart.lineItems.length) Checkout
    script.
      function isCartOpen() {
        return document.getElementById('cart').className.match(/(?:^|\s)cart--open(?!\S)/);
      }
      function closeCart() {
        document.getElementById('cart').className = document.getElementById('cart').className.replace(/(?:^|\s)cart--open(?!\S)/g, '' )
      }

      function openCart() {
        if (!isCartOpen()) {
          document.getElementById('cart').className += ' cart--open';
        }
      }

      if (document.getElementById('quantity')) {
        document.getElementById('quantity').onchange = function() {
          this.form.submit();
        };
      }

      document.getElementById('checkout-button').onclick = function () {
        window.open('#{cart.webUrl}');
      };

      document.getElementById('add-to-cart-button').onsubmit = openCart;

      document.getElementById('view-cart-button').onclick = openCart;

      document.getElementById('close-cart-button').onclick = closeCart;
